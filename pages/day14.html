<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>DAY 14: SQL - Window Functions Part 2 (LAG, LEAD, Running Totals)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    
    :root {
      /* Light theme (default - Claude style) */
      --bg-primary: #F5F3EF;
      --bg-secondary: #FFFFFF;
      --bg-sidebar: #FDFCFA;
      --text-primary: #1A1A1A;
      --text-secondary: #6B6B6B;
      --text-tertiary: #9B9B9B;
      --accent-orange: #D97757;
      --accent-brown: #8B6B47;
      --border-subtle: #E5E2DC;
      --border-light: #F0EDE7;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    [data-theme="dark"] {
      /* Dark theme (Claude desktop style) */
      --bg-primary: #1F1F1F;
      --bg-secondary: #2B2B2B;
      --bg-sidebar: #242424;
      --text-primary: #ECECEC;
      --text-secondary: #A8A8A8;
      --text-tertiary: #7A7A7A;
      --accent-orange: #E89A7A;
      --accent-brown: #B8936A;
      --border-subtle: #3A3A3A;
      --border-light: #333333;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
    }

    /* Font families */
    html {
      font-family: Candara, 'Gill Sans', 'Gill Sans MT', Calibri, sans-serif;
    }

    [data-font="candara"] {
      font-family: Candara, 'Gill Sans', 'Gill Sans MT', Calibri, sans-serif;
    }

    [data-font="arial"] {
      font-family: Arial, Helvetica, sans-serif;
    }

    [data-font="courier"] {
      font-family: 'Courier New', Courier, monospace;
    }

    [data-font="georgia"] {
      font-family: Georgia, 'Times New Roman', serif;
    }

    [data-font="dyslexic"] {
      font-family: 'OpenDyslexic', sans-serif;
    }

    /* Font sizes */
    html {
      font-size: 16px;
    }

    [data-font-size="small"] {
      font-size: 14px;
    }

    [data-font-size="medium"] {
      font-size: 16px;
    }

    [data-font-size="large"] {
      font-size: 18px;
    }

    [data-font-size="x-large"] {
      font-size: 20px;
    }

    html, body {
      height: 100%;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Header */
    #title-block-header {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      border-bottom: 3px solid var(--accent-orange);
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-lg);
    }

    .header-row {
      max-width: 1600px;
      margin: 0 auto;
      padding: 1.25rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .title {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-brown) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
      margin: 0;
      white-space: nowrap;
    }

    .header-author {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-left: auto;
    }

    .author-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
      font-style: italic;
    }

    .repo-link {
      display: flex;
      align-items: center;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      padding: 0.25rem;
      border-radius: var(--radius-sm);
    }

    .repo-link:hover {
      color: var(--accent-orange);
      background: var(--bg-primary);
      transform: scale(1.1);
    }

    .repo-link svg {
      display: block;
    }

    .header-controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .font-selector {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      outline: none;
    }

    .font-selector:hover {
      background: var(--bg-secondary);
      border-color: var(--accent-brown);
      color: var(--text-primary);
    }

    .font-selector:focus {
      border-color: var(--accent-orange);
      box-shadow: 0 0 0 3px rgba(217, 119, 87, 0.1);
    }

    .font-size-controls {
      display: flex;
      gap: 0.25rem;
      align-items: center;
    }

    .font-size-btn {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      width: 2.25rem;
      height: 2.25rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.75rem;
      font-weight: 600;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .font-size-btn:hover {
      background: var(--bg-secondary);
      border-color: var(--accent-brown);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .font-size-btn:active {
      transform: translateY(0);
    }

    .font-size-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .font-size-btn:disabled:hover {
      background: var(--bg-primary);
      border-color: var(--border-subtle);
      transform: none;
    }

    .theme-toggle {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      padding: 0.5rem 0.875rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .theme-toggle:hover {
      background: var(--bg-secondary);
      border-color: var(--accent-brown);
      color: var(--text-primary);
    }

    .button {
      background: var(--bg-primary);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
      padding: 0.5rem 0.875rem;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .button:hover {
      background: var(--bg-secondary);
      border-color: var(--accent-brown);
      color: var(--text-primary);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* Layout */
    .page {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      gap: 2rem;
      padding: 2rem;
      min-height: calc(100vh - 80px);
    }

    /* Modern Sidebar */
    nav#TOC {
      width: 320px;
      min-width: 320px;
      background: var(--bg-sidebar);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      align-self: flex-start;
      position: sticky;
      top: 100px;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      box-shadow: var(--shadow-sm);
      scroll-behavior: smooth;
    }

    nav#TOC::-webkit-scrollbar {
      width: 6px;
    }

    nav#TOC::-webkit-scrollbar-track {
      background: transparent;
    }

    nav#TOC::-webkit-scrollbar-thumb {
      background: var(--border-subtle);
      border-radius: 3px;
    }

    nav#TOC::-webkit-scrollbar-thumb:hover {
      background: var(--accent-brown);
    }

    nav#TOC ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    nav#TOC > ul > li {
      margin-bottom: 1.5rem;
    }

    nav#TOC li {
      margin: 0;
    }

    nav#TOC a {
      display: block;
      color: var(--text-secondary);
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
      font-size: 0.8125rem;
      font-weight: 500;
      transition: all 0.2s ease;
      line-height: 1.4;
    }

    nav#TOC > ul > li > a {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    nav#TOC a:hover {
      background: var(--bg-secondary);
      color: var(--accent-orange);
      transform: translateX(2px);
    }

    /* Active page highlighting */
    nav#TOC a.active {
      background: var(--accent-orange);
      color: white;
      font-weight: 600;
    }

    nav#TOC a.active:hover {
      background: var(--accent-brown);
      color: white;
    }

    nav#TOC ul ul {
      margin-top: 0.25rem;
      margin-left: 0.75rem;
      padding-left: 0.75rem;
      border-left: 2px solid var(--border-light);
    }

    /* Content Area */
    .content {
      flex: 1;
      min-width: 0;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 3rem;
      box-shadow: var(--shadow-sm);
    }

    /* Typography */
    h1 {
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.02em;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--border-subtle);
    }

    h2 {
      font-size: 1.875rem;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.015em;
      margin: 2.5rem 0 1.5rem 0;
      padding: 1.25rem 1.5rem;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      border-left: 4px solid var(--accent-orange);
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-sm);
    }

    h3 {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 2rem 0 1rem 0;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-light);
    }

    p {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.7;
    }

    strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    a {
      color: var(--accent-orange);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    a:hover {
      color: var(--accent-brown);
      text-decoration: underline;
    }

    /* External Links with Icon */
    .external-link {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.5rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--accent-orange);
      transition: all 0.2s ease;
      word-break: break-all;
    }

    .external-link:hover {
      background: var(--accent-orange);
      color: white;
      border-color: var(--accent-orange);
      text-decoration: none;
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .link-icon {
      flex-shrink: 0;
      opacity: 0.7;
      transition: opacity 0.2s ease;
    }

    .external-link:hover .link-icon {
      opacity: 1;
    }

    /* Lists */
    ul, ol {
      margin: 1rem 0;
      padding-left: 1.5rem;
      color: var(--text-secondary);
    }

    li {
      margin: 0.5rem 0;
      line-height: 1.6;
    }

    /* Code */
    code {
      background: var(--bg-primary);
      color: var(--accent-brown);
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
      font-size: 0.875em;
      font-weight: 500;
    }

    pre {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      overflow-x: auto;
      margin: 1.5rem 0;
      position: relative;
    }

    pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* Copy button for code blocks */
    .copy-btn {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      padding: 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }

    pre:hover .copy-btn {
      opacity: 1;
    }

    .copy-btn:hover {
      background: var(--accent-orange);
      color: white;
      border-color: var(--accent-orange);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .copy-btn.copied {
      background: var(--accent-brown);
      color: white;
    }

    .copy-btn svg {
      flex-shrink: 0;
    }

    /* AI Assistant Buttons - Dynamically Added */
    .ai-assistant-buttons {
      position: absolute;
      bottom: 0.75rem;
      right: 0.75rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    pre:hover .ai-assistant-buttons {
      opacity: 1;
    }

    .ai-quick-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8125rem;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s ease;
      border: 1px solid;
      min-width: 36px;
      min-height: 36px;
    }

    /* All AI buttons - Consistent black and white theme */
    .chatgpt-btn,
    .claude-btn,
    .google-btn {
      background: #000000;
      color: white;
      border-color: #333333;
    }

    .chatgpt-btn:hover,
    .claude-btn:hover,
    .google-btn:hover {
      background: #333333;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      text-decoration: none;
    }

    /* Make sure icons are white */
    .ai-quick-btn svg,
    .ai-quick-btn img {
      filter: brightness(0) invert(1);
    }

    .ai-quick-btn svg {
      flex-shrink: 0;
    }

    /* Quiz Styles */
    .quiz-container {
      margin: 2rem 0;
      padding: 1.5rem;
      background: var(--bg-primary);
      border: 2px solid var(--accent-orange);
      border-radius: var(--radius-md);
    }

    .quiz-question {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      border-left: 4px solid var(--text-tertiary);
      transition: border-color 0.3s ease;
    }

    .quiz-question.correct {
      border-left-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }

    .quiz-question.incorrect {
      border-left-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    .question-text {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      padding: 0.875rem 1.25rem;
      background: var(--bg-primary);
      border: 2px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .quiz-option:hover {
      border-color: var(--accent-orange);
      transform: translateX(4px);
    }

    .quiz-option input[type="radio"] {
      margin-right: 0.75rem;
      cursor: pointer;
    }

    .option-text {
      color: var(--text-secondary);
      font-size: 0.9375rem;
    }

    .quiz-feedback {
      margin-top: 1rem;
      padding: 1rem 1.25rem;
      border-radius: var(--radius-sm);
    }

    .quiz-feedback.correct {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid #10b981;
    }

    .quiz-feedback.incorrect {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid #ef4444;
    }

    .feedback-text {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .feedback-text.correct {
      color: #10b981;
    }

    .feedback-text.incorrect {
      color: #ef4444;
    }

    .explanation {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-style: italic;
      margin: 0;
    }


    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    th, td {
      padding: 0.875rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    th {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    td {
      color: var(--text-secondary);
    }

    tr:last-child td {
      border-bottom: none;
    }

    /* Horizontal Rule */
    hr {
      border: none;
      height: 1px;
      background: var(--border-subtle);
      margin: 2.5rem 0;
    }

    /* Feedback Bar */
    .feedback-bar {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-subtle);
      padding: 1.5rem 2rem;
      text-align: center;
      margin-top: 3rem;
    }

    .feedback-bar p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .feedback-link {
      color: var(--accent-orange);
      font-weight: 500;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .feedback-link:hover {
      color: var(--accent-brown);
      text-decoration: underline;
    }

    /* Practice Notes */
    .practice-note {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-left: 4px solid var(--accent-brown);
      border-radius: var(--radius-sm);
      padding: 1.25rem 1.5rem;
      margin: 1rem 0 1.5rem 0;
    }

    .practice-note p {
      margin-bottom: 0.75rem;
      color: var(--text-primary);
    }

    .practice-note ul {
      margin: 0;
      padding-left: 1.5rem;
    }

    .practice-note li {
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      line-height: 1.6;
    }

    .practice-note strong {
      color: var(--text-primary);
    }

    /* Back to top - Fixed button */
    .back-to-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 3rem;
      height: 3rem;
      background: var(--accent-orange);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s ease;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: visible;
    }

    .back-to-top::before {
      content: '‚Üë';
      display: block;
    }

    .back-to-top::after {
      content: 'Back to Top';
      position: absolute;
      right: 100%;
      margin-right: 0.75rem;
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-subtle);
    }

    .back-to-top:hover {
      background: var(--accent-brown);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .back-to-top:hover::after {
      opacity: 1;
    }

    /* Section Cards */
    .section-card {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .page {
        flex-direction: column;
        padding: 1rem;
      }

      nav#TOC {
        position: static;
        width: 100%;
        max-height: none;
        margin-bottom: 2rem;
      }

      .content {
        padding: 2rem 1.5rem;
      }
    }

    @media (max-width: 640px) {
      .header-row {
        padding: 1rem;
      }

      .title {
        font-size: 1rem;
      }

      .content {
        padding: 1.5rem 1rem;
      }

      h1 {
        font-size: 1.75rem;
      }

      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>

<body>
<header id="title-block-header">
  <div class="header-row">
    <h1 class="title">DAY 14: SQL - Window Functions Part 2 (LAG, LEAD, Running Totals)</h1>
    <div class="header-author">
      <span class="author-name">Guru Charan Pathalla</span>
      <a href="https://github.com/gcpathalla/sql_and_excel" target="_blank" class="repo-link" title="View on GitHub">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
        </svg>
      </a>
    </div>
    <div class="header-controls">
      <select class="font-selector" id="font-selector" aria-label="Select font">
        <option value="candara">Candara</option>
        <option value="arial">Arial</option>
        <option value="courier">Courier New</option>
        <option value="georgia">Georgia</option>
        <option value="dyslexic">OpenDyslexic</option>
      </select>
      <div class="font-size-controls">
        <button class="font-size-btn" id="decrease-font" aria-label="Decrease font size" title="Decrease font size">A-</button>
        <button class="font-size-btn" id="increase-font" aria-label="Increase font size" title="Increase font size">A+</button>
      </div>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <span class="theme-icon">üåô</span>
        <span class="theme-text">Dark</span>
      </button>
    </div>
  </div>
</header>
<div class="page">
  <nav id="TOC" role="navigation">
<ul>
<li><a href="../SQL-and-Excel-Course.html">üìö Training Overview</a></li>
<li><a href="week1.html">Week 1: Foundations</a>
<ul>
<li><a href="day1.html">Day 1: Excel - Formulas
& Basic Functions</a></li>
<li><a href="day2.html">Day 2: SQL - SELECT &
Aggregates</a></li>
<li><a href="day3.html">Day 3: Excel -
Filtering & Conditional Funct...</a></li>
<li><a href="day4.html">Day 4: SQL - WHERE Clause
& Filtering</a></li>
<li><a href="day5.html">Day 5: Excel - VLOOKUP &
XLOOKUP</a></li>
</ul>
</li>
<li><a href="week2.html">Week 2: Data Analysis</a>
<ul>
<li><a href="day6.html">Day 6: SQL - JOIN Operations</a></li>
<li><a href="day7.html">Day 7: Excel - Pivot Tables
& Charts</a></li>
<li><a href="day8.html">Day 8: SQL - GROUP BY &
HAVING</a></li>
<li><a href="day9.html">Day 9: Excel - Advanced Functions (SUMIFS, C...</a></li>
<li><a href="day10.html">Day 10: SQL - Subqueries</a></li>
</ul>
</li>
<li><a href="week3.html">Week 3: Intermediate Concepts</a>
<ul>
<li><a href="day11.html">Day 11: Excel - Date Functions (TODAY, DATEDI...</a></li>
<li><a href="day12.html">Day 12: SQL - Date Functions & Window Functio...</a></li>
<li><a href="day13.html">Day 13: Excel - What-If Analysis (Goal Seek, ...</a></li>
<li><a href="day14.html">Day 14: SQL - Window Functions Part 2 (LAG, L...</a></li>
<li><a href="day15.html">Day 15: Excel - Power Query Basics + WEEK 3 TEST</a></li>
</ul>
</li>
<li><a href="week4.html">Week 4: Advanced Concepts</a>
<ul>
<li><a href="day16.html">Day 16: SQL - CTEs & Recursive Queries</a></li>
<li><a href="day17.html">Day 17: Excel - Power Pivot & Data Modeling (...</a></li>
<li><a href="day18.html">Day 18: SQL - CASE Statements & PIVOT/UNPIVOT</a></li>
<li><a href="day19.html">Day 19: Excel - Advanced Charts & Dashboards</a></li>
<li><a href="day20.html">Day 20: SQL - Views, Stored Procedures, Optim...</a></li>
</ul>
</li>
<li><a href="week5.html">Week 5: Analytics & Optimization</a>
<ul>
<li><a href="day21.html">Day 21: Excel - Statistical Analysis & Foreca...</a></li>
<li><a href="day22.html">Day 22: SQL - Advanced Aggregations (GROUPING...</a></li>
<li><a href="day23.html">Day 23: Excel - Advanced Conditional Formatti...</a></li>
<li><a href="day24.html">Day 24: SQL - Query Optimization & Performanc...</a></li>
<li><a href="day25.html">Day 25: Integration Project: Excel + SQL + WE...</a></li>
</ul>
</li>
<li><a href="week6.html">Week 6: Mastery & Projects</a>
<ul>
<li><a href="day26.html">Day 26: Excel - Macros & Automation Basics</a></li>
<li><a href="day27.html">Day 27: SQL - Advanced Analytics (Cohort, Ret...</a></li>
<li><a href="day28.html">Day 28: Excel - Executive Dashboard Creation</a></li>
<li><a href="day29.html">Day 29: SQL - Complex Business Scenarios</a></li>
<li><a href="day30.html">Day 30: FINAL PROJECT & COMPREHENSIVE ASSESSMENT</a></li>
</ul>
</li>
</ul>
  </nav>
  <div class="content">
<h2 id="day-14-day-14-sql---window-functions-part-2-lag-lead-running-totals">DAY 14: SQL - Window Functions Part 2 (LAG, LEAD, Running Totals)</h2>
<p><strong>Learning Objectives:</strong>
- Use LAG and LEAD for accessing previous/next rows
- Calculate running totals with window functions
- Compute moving averages
- Perform period-over-period comparisons
- Master cumulative aggregations</p>
<h3 id="topics-covered-hour-1---60-min-14">Topics Covered (60 min):</h3>
<p><strong>1. LAG Function</strong>
- Access previous row value
- Syntax: <code>LAG(column, offset, default) OVER (ORDER BY column)</code>
- Compare current row to previous row
- Example: Compare this month sales vs last month</p>
<p><strong>2. LEAD Function</strong>
- Access next row value
- Syntax: <code>LEAD(column, offset, default) OVER (ORDER BY column)</code>
- Look ahead in data
- Example: Compare current order to next order</p>
<p><strong>3. Running Totals</strong>
- Cumulative sum using SUM() OVER
- Syntax: <code>SUM(amount) OVER (ORDER BY date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)</code>
- Year-to-date, quarter-to-date calculations
- Running balance calculations</p>
<p><strong>4. Moving Averages</strong>
- Calculate average over sliding window
- Example: 7-day moving average
- Syntax: <code>AVG(sales) OVER (ORDER BY date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)</code>
- Smoothing trends and patterns</p>
<h3 id="video-resources-14">Video Resources:</h3>
<ol type="1">
<li><p><strong>Learn SQL String Functions - Trimming and Pattern Matching</strong> (5:53)<br/>
<a class="external-link" href="https://www.youtube.com/watch?v=laiTKI0rwHg" target="_blank" title="Open link"><svg class="link-icon" fill="currentColor" height="14" viewbox="0 0 16 16" width="14"><path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path><path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path></svg> https://www.youtube.com/watch?v=laiTKI0rwHg</a></p></li>
<li><p><strong>SQL String Functions Explained With Examples!</strong> (1:16)<br/>
<a class="external-link" href="https://www.youtube.com/watch?v=LKk8OzYFnc4" target="_blank" title="Open link"><svg class="link-icon" fill="currentColor" height="14" viewbox="0 0 16 16" width="14"><path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path><path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path></svg> https://www.youtube.com/watch?v=LKk8OzYFnc4</a></p></li>
<li><p><strong>Mastering SQL String Functions: A Practical Guide for Beginners</strong> (17:28)<br/>
<a class="external-link" href="https://www.youtube.com/watch?v=2sCsEmLS_5I" target="_blank" title="Open link"><svg class="link-icon" fill="currentColor" height="14" viewbox="0 0 16 16" width="14"><path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path><path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path></svg> https://www.youtube.com/watch?v=2sCsEmLS_5I</a></p></li>
</ol>
<h3 id="ai-learning-prompts-concept-understanding-only-14">AI Learning Prompts (Concept Understanding Only):</h3>
<p><strong>Understanding LAG and LEAD:</strong></p>
<pre><code>I'm learning SQL LAG and LEAD functions. Please explain:

1. What is the difference between LAG and LEAD?
2. How do I compare current month sales to previous month?
3. Show me how to calculate month-over-month growth rate
4. How do I use PARTITION BY with LAG/LEAD?
5. Provide examples using sales data with time series

Use SQL Server syntax with clear examples.</code></pre>
<p><strong>Understanding Running Totals:</strong></p>
<pre><code>Help me understand running totals and moving averages:

1. What is the difference between running total and regular SUM?
2. How do I calculate year-to-date sales?
3. Explain ROWS BETWEEN in window functions
4. Show me how to calculate 7-day moving average
5. How do I create running balance for account transactions?

Provide practical examples for financial analysis.</code></pre>
<h3 id="guided-practice-hour-2---60-min-14">Guided Practice (60 min):</h3>
<div class="practice-note">
<p><strong>üìù How to approach Guided Practice:</strong></p>
<ul>
<li><strong>Follow step-by-step:</strong> Work through each exercise in order</li>
<li><strong>Use provided resources:</strong> Reference the video tutorials and AI prompts if you get stuck</li>
<li><strong>Verify your work:</strong> Check your results match expected outcomes</li>
<li><strong>Take notes:</strong> Document key learnings and shortcuts you discover</li>
<li><strong>Ask for help:</strong> Use AI assistants to clarify concepts you don't understand</li>
</ul>
</div>
<div class="section-card">
<p><strong>Exercise 1: Calculate Month-Over-Month Sales Change with LAG</strong></p>
<p><strong>Goal:</strong> Learn to use the LAG function to compare current month sales with the previous month and calculate the percentage change.</p>

<p><strong>Step-by-Step Instructions:</strong></p>
<ol>
<li><strong>Open your SQL editor</strong> and connect to your sales database</li>
<li><strong>Understand the requirement:</strong> For each month, we want to see current month sales, previous month sales, and the percentage change</li>
<li><strong>Start with a basic monthly aggregation:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add LAG function to get previous month's sales:</strong> Press <code>Ctrl+Home</code> to go to the start, modify the query to:
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS CurrentMonthSales,
    LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PreviousMonthSales
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Calculate the month-over-month change:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS CurrentMonthSales,
    LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PreviousMonthSales,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS SalesChange
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add percentage change calculation:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS CurrentMonthSales,
    LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PreviousMonthSales,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS SalesChange,
    CASE
        WHEN LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) = 0 THEN NULL
        ELSE ROUND(((SUM(TotalAmount) - LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)))
                    / LAG(SUM(TotalAmount), 1, 0) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate))) * 100, 2)
    END AS PercentChange
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Execute the query</strong> by pressing <code>F5</code> or <code>Ctrl+E</code> and review the month-over-month comparison</li>
<li><strong>Verify the results:</strong> Check that each month shows its sales compared to the previous month with accurate percentage calculations</li>
</ol>

<p><strong>üí° Tips:</strong></p>
<ul>
<li><strong>LAG syntax:</strong> <code>LAG(column, offset, default_value) OVER (ORDER BY ...)</code> - offset is how many rows back (1 = previous row)</li>
<li><strong>Default value matters:</strong> The third parameter (0 in this case) handles the first row which has no previous month</li>
<li><strong>OVER clause ordering:</strong> The ORDER BY in OVER determines which row is "previous" - always order by your time dimension</li>
<li><strong>Avoid division by zero:</strong> Use CASE to check if previous month sales is 0 before calculating percentage</li>
<li><strong>PARTITION BY for categories:</strong> Add <code>PARTITION BY ProductCategory</code> to compare within each category separately</li>
<li><strong>Keyboard shortcut:</strong> Use <code>Ctrl+K, Ctrl+C</code> to comment out lines while testing different variations</li>
</ul>

<p><strong>‚úÖ Expected Result:</strong> A table showing each month with columns: OrderYear, OrderMonth, CurrentMonthSales, PreviousMonthSales, SalesChange, PercentChange (e.g., 2024, 10, $50,000, $45,000, $5,000, 11.11%)</p>

<p><strong>üîÑ Connection to Day 12:</strong> Day 12 introduced basic window functions like ROW_NUMBER and RANK. LAG extends this by allowing you to reference specific previous rows, enabling powerful time-series comparisons without self-joins!</p>
</div>

<div class="section-card">
<p><strong>Exercise 2: Use LEAD to Identify Future Order Trends</strong></p>
<p><strong>Goal:</strong> Master the LEAD function to look ahead in your data and identify upcoming customer behavior patterns.</p>

<p><strong>Step-by-Step Instructions:</strong></p>
<ol>
<li><strong>Open your SQL editor</strong> with the customer orders dataset</li>
<li><strong>Understand the scenario:</strong> For each customer order, we want to see when their next order will be and how many days between orders</li>
<li><strong>Create a base query showing customer orders:</strong>
<pre><code>SELECT
    CustomerID,
    OrderID,
    OrderDate,
    TotalAmount
FROM Orders
ORDER BY CustomerID, OrderDate;</code></pre>
</li>
<li><strong>Add LEAD to find next order date:</strong>
<pre><code>SELECT
    CustomerID,
    OrderID,
    OrderDate,
    TotalAmount,
    LEAD(OrderDate, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate) AS NextOrderDate
FROM Orders
ORDER BY CustomerID, OrderDate;</code></pre>
</li>
<li><strong>Calculate days until next order:</strong>
<pre><code>SELECT
    CustomerID,
    OrderID,
    OrderDate,
    TotalAmount,
    LEAD(OrderDate, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate) AS NextOrderDate,
    DATEDIFF(day, OrderDate, LEAD(OrderDate, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate)) AS DaysUntilNextOrder
FROM Orders
ORDER BY CustomerID, OrderDate;</code></pre>
</li>
<li><strong>Add next order amount for comparison:</strong>
<pre><code>SELECT
    CustomerID,
    OrderID,
    OrderDate,
    TotalAmount AS CurrentOrderAmount,
    LEAD(OrderDate, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate) AS NextOrderDate,
    LEAD(TotalAmount, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate) AS NextOrderAmount,
    DATEDIFF(day, OrderDate, LEAD(OrderDate, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate)) AS DaysUntilNextOrder,
    CASE
        WHEN TotalAmount < LEAD(TotalAmount, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate) THEN 'Increasing'
        WHEN TotalAmount > LEAD(TotalAmount, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate) THEN 'Decreasing'
        ELSE 'Stable'
    END AS OrderValueTrend
FROM Orders
ORDER BY CustomerID, OrderDate;</code></pre>
</li>
<li><strong>Filter to show customers with decreasing order frequency:</strong>
<pre><code>WITH OrderTrends AS (
    SELECT
        CustomerID,
        OrderID,
        OrderDate,
        DATEDIFF(day, OrderDate, LEAD(OrderDate, 1) OVER (PARTITION BY CustomerID ORDER BY OrderDate)) AS DaysUntilNextOrder
    FROM Orders
)
SELECT
    CustomerID,
    AVG(DaysUntilNextOrder) AS AvgDaysBetweenOrders
FROM OrderTrends
WHERE DaysUntilNextOrder IS NOT NULL
GROUP BY CustomerID
HAVING AVG(DaysUntilNextOrder) > 30
ORDER BY AvgDaysBetweenOrders DESC;</code></pre>
</li>
<li><strong>Execute and analyze:</strong> Press <code>F5</code> to identify customers who may be at risk of churning</li>
</ol>

<p><strong>üí° Tips:</strong></p>
<ul>
<li><strong>LEAD vs LAG:</strong> LEAD looks forward, LAG looks backward - use LEAD for predictions and forecasting scenarios</li>
<li><strong>PARTITION BY is crucial:</strong> Always partition by CustomerID when analyzing per-customer trends to avoid mixing data</li>
<li><strong>NULL handling:</strong> The last order for each customer will have NULL for NextOrderDate - this is expected behavior</li>
<li><strong>Multiple offsets:</strong> Use <code>LEAD(OrderDate, 2)</code> to look 2 orders ahead, <code>LEAD(OrderDate, 3)</code> for 3, etc.</li>
<li><strong>Business insight:</strong> Increasing days between orders often indicates declining engagement - great for retention campaigns</li>
<li><strong>CTE for clarity:</strong> Use Common Table Expressions (CTEs) with WITH to make complex LEAD queries more readable</li>
</ul>

<p><strong>‚úÖ Expected Result:</strong> A table showing each order with its next order date and the gap in days (e.g., CustomerID: 101, OrderDate: 2024-01-15, NextOrderDate: 2024-02-20, DaysUntilNextOrder: 36, OrderValueTrend: 'Increasing')</p>

<p><strong>üîÑ Connection to Day 12:</strong> While Day 12 showed window functions for ranking, LEAD adds temporal analysis capabilities. Combined with DATEDIFF from Day 12, you can now perform sophisticated customer behavior analysis!</p>
</div>

<div class="section-card">
<p><strong>Exercise 3: Create Running Totals for Year-to-Date Revenue</strong></p>
<p><strong>Goal:</strong> Learn to calculate running totals and cumulative sums using window functions with frame specifications.</p>

<p><strong>Step-by-Step Instructions:</strong></p>
<ol>
<li><strong>Open your SQL editor</strong> and ensure you have access to daily sales data</li>
<li><strong>Understand running totals:</strong> A running total accumulates values from the first row to the current row, essential for YTD calculations</li>
<li><strong>Create a basic daily sales summary:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales
FROM Orders
WHERE YEAR(OrderDate) = 2024
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Add a simple running total:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    SUM(SUM(TotalAmount)) OVER (ORDER BY OrderDate) AS RunningTotal
FROM Orders
WHERE YEAR(OrderDate) = 2024
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Make it explicit with ROWS BETWEEN:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    SUM(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS RunningTotal
FROM Orders
WHERE YEAR(OrderDate) = 2024
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Add Year-to-Date sales by month:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS YearToDateSales
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add Quarter-to-Date calculations:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    DATEPART(QUARTER, OrderDate) AS OrderQuarter,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate), DATEPART(QUARTER, OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS QuarterToDateSales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS YearToDateSales
FROM Orders
GROUP BY YEAR(OrderDate), DATEPART(QUARTER, OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderQuarter, OrderMonth;</code></pre>
</li>
<li><strong>Add percentage of annual target:</strong>
<pre><code>DECLARE @AnnualTarget DECIMAL(12,2) = 1000000;

SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS YearToDateSales,
    ROUND((SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) / @AnnualTarget) * 100, 2) AS PercentOfTarget
FROM Orders
WHERE YEAR(OrderDate) = 2024
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Execute the query</strong> with <code>F5</code> and verify running totals increase monotonically</li>
</ol>

<p><strong>üí° Tips:</strong></p>
<ul>
<li><strong>ROWS BETWEEN syntax:</strong> <code>UNBOUNDED PRECEDING AND CURRENT ROW</code> means "from the start to current row" - this is the running total frame</li>
<li><strong>PARTITION BY resets:</strong> Use PARTITION BY YEAR to restart running total each year, essential for YTD calculations</li>
<li><strong>Performance consideration:</strong> Running totals on very large datasets can be slow - consider indexing on date columns</li>
<li><strong>Default frame:</strong> When you omit ROWS BETWEEN with ORDER BY, SQL uses RANGE UNBOUNDED PRECEDING by default (slightly different behavior)</li>
<li><strong>Nested aggregations:</strong> Notice <code>SUM(SUM(TotalAmount))</code> - outer SUM is window function, inner SUM is GROUP BY aggregate</li>
<li><strong>Keyboard shortcut:</strong> Use <code>Ctrl+Shift+U</code> to uppercase SQL keywords for better readability</li>
</ul>

<p><strong>‚úÖ Expected Result:</strong> A table showing each month with cumulative sales growing throughout the year (e.g., Jan: $50k, Feb: $105k, Mar: $165k, etc.) with YTD and QTD totals plus percentage of annual target</p>

<p><strong>üîÑ Connection to Day 12:</strong> Day 12 introduced window functions with OVER clause. Running totals extend this by using frame specifications (ROWS BETWEEN) to define exactly which rows participate in the calculation - a powerful analytical tool!</p>
</div>

<div class="section-card">
<p><strong>Exercise 4: Calculate 7-Day Moving Average for Sales Trends</strong></p>
<p><strong>Goal:</strong> Master moving averages to smooth out daily fluctuations and identify underlying sales trends.</p>

<p><strong>Step-by-Step Instructions:</strong></p>
<ol>
<li><strong>Open your SQL editor</strong> with daily sales data available</li>
<li><strong>Understand moving averages:</strong> A 7-day moving average calculates the average of the current day plus the previous 6 days, creating a smoothed trend line</li>
<li><strong>Start with daily sales data:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales
FROM Orders
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Add a 7-day moving average:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS SevenDayMovingAvg
FROM Orders
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Add 30-day moving average for comparison:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS SevenDayMovingAvg,
    AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
    ) AS ThirtyDayMovingAvg
FROM Orders
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Round the averages for readability:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    ROUND(AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ), 2) AS SevenDayMovingAvg,
    ROUND(AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
    ), 2) AS ThirtyDayMovingAvg
FROM Orders
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Add trend indicators:</strong>
<pre><code>SELECT
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    ROUND(AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ), 2) AS SevenDayMovingAvg,
    CASE
        WHEN SUM(TotalAmount) > AVG(SUM(TotalAmount)) OVER (
            ORDER BY OrderDate
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) THEN 'Above Average'
        ELSE 'Below Average'
    END AS TrendIndicator,
    ROUND((SUM(TotalAmount) - AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    )) / AVG(SUM(TotalAmount)) OVER (
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) * 100, 2) AS PercentDeviation
FROM Orders
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
GROUP BY OrderDate
ORDER BY OrderDate;</code></pre>
</li>
<li><strong>Create a product-specific moving average:</strong>
<pre><code>SELECT
    ProductCategory,
    OrderDate,
    SUM(TotalAmount) AS DailySales,
    ROUND(AVG(SUM(TotalAmount)) OVER (
        PARTITION BY ProductCategory
        ORDER BY OrderDate
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ), 2) AS SevenDayMovingAvg
FROM Orders
WHERE OrderDate >= DATEADD(day, -90, GETDATE())
GROUP BY ProductCategory, OrderDate
ORDER BY ProductCategory, OrderDate;</code></pre>
</li>
<li><strong>Execute the query</strong> using <code>F5</code> and observe how moving averages smooth daily volatility</li>
</ol>

<p><strong>üí° Tips:</strong></p>
<ul>
<li><strong>Frame specification:</strong> <code>ROWS BETWEEN 6 PRECEDING AND CURRENT ROW</code> creates a 7-day window (6 previous + current = 7 total days)</li>
<li><strong>Edge cases:</strong> First 6 days will have fewer than 7 days in the average - this is normal and expected</li>
<li><strong>Smoothing effect:</strong> Larger windows (30-day) are smoother but slower to react; smaller windows (7-day) are more responsive</li>
<li><strong>Seasonal patterns:</strong> Moving averages are excellent for identifying seasonal trends in sales data</li>
<li><strong>Multiple partitions:</strong> Add PARTITION BY to calculate separate moving averages for each product, region, or category</li>
<li><strong>Comparison insight:</strong> When 7-day MA crosses above 30-day MA, it often signals an upward trend (and vice versa)</li>
</ul>

<p><strong>‚úÖ Expected Result:</strong> A table showing daily sales with smoothed 7-day and 30-day moving averages (e.g., 2024-11-15, DailySales: $12,500, 7-Day Avg: $11,200, 30-Day Avg: $10,800, TrendIndicator: 'Above Average')</p>

<p><strong>üîÑ Connection to Day 12:</strong> Building on Day 12's window functions, moving averages use the same OVER clause but with specific frame specifications. This transforms basic aggregations into powerful trend analysis tools used in financial and sales forecasting!</p>
</div>

<div class="section-card">
<p><strong>Exercise 5: Combine LAG, LEAD, and Running Totals for Comprehensive Analysis</strong></p>
<p><strong>Goal:</strong> Master combining multiple window functions in a single query to create a comprehensive sales performance dashboard.</p>

<p><strong>Step-by-Step Instructions:</strong></p>
<ol>
<li><strong>Open your SQL editor</strong> ready to build a complex analytical query</li>
<li><strong>Understand the goal:</strong> Create a single query showing month-over-month comparisons, running totals, moving averages, and forward-looking predictions</li>
<li><strong>Start with monthly sales aggregation:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add LAG for previous month comparison:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PrevMonthSales,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS MonthOverMonthChange
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add LEAD for next month forecast context:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PrevMonthSales,
    LEAD(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS NextMonthSales,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS MonthOverMonthChange
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add running total for YTD:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PrevMonthSales,
    LEAD(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS NextMonthSales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS UNBOUNDED PRECEDING
    ) AS YearToDateSales,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS MonthOverMonthChange
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add 3-month moving average:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PrevMonthSales,
    LEAD(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS NextMonthSales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS UNBOUNDED PRECEDING
    ) AS YearToDateSales,
    ROUND(AVG(SUM(TotalAmount)) OVER (
        ORDER BY YEAR(OrderDate), MONTH(OrderDate)
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ), 2) AS ThreeMonthMovingAvg,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS MonthOverMonthChange
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Add performance indicators and percentages:</strong>
<pre><code>SELECT
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(TotalAmount) AS MonthlySales,
    LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PrevMonthSales,
    LEAD(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS NextMonthSales,
    SUM(SUM(TotalAmount)) OVER (
        PARTITION BY YEAR(OrderDate)
        ORDER BY MONTH(OrderDate)
        ROWS UNBOUNDED PRECEDING
    ) AS YearToDateSales,
    ROUND(AVG(SUM(TotalAmount)) OVER (
        ORDER BY YEAR(OrderDate), MONTH(OrderDate)
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ), 2) AS ThreeMonthMovingAvg,
    SUM(TotalAmount) - LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS MonthOverMonthChange,
    CASE
        WHEN LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) IS NULL THEN NULL
        ELSE ROUND(((SUM(TotalAmount) - LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)))
                    / LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate))) * 100, 2)
    END AS PercentChange,
    CASE
        WHEN SUM(TotalAmount) > AVG(SUM(TotalAmount)) OVER (
            ORDER BY YEAR(OrderDate), MONTH(OrderDate)
            ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
        ) THEN 'Above Trend'
        WHEN SUM(TotalAmount) < AVG(SUM(TotalAmount)) OVER (
            ORDER BY YEAR(OrderDate), MONTH(OrderDate)
            ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
        ) THEN 'Below Trend'
        ELSE 'On Trend'
    END AS TrendStatus
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Wrap in a CTE for better readability:</strong>
<pre><code>WITH MonthlySalesAnalysis AS (
    SELECT
        YEAR(OrderDate) AS OrderYear,
        MONTH(OrderDate) AS OrderMonth,
        SUM(TotalAmount) AS MonthlySales,
        LAG(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS PrevMonthSales,
        LEAD(SUM(TotalAmount), 1) OVER (ORDER BY YEAR(OrderDate), MONTH(OrderDate)) AS NextMonthSales,
        SUM(SUM(TotalAmount)) OVER (
            PARTITION BY YEAR(OrderDate)
            ORDER BY MONTH(OrderDate)
            ROWS UNBOUNDED PRECEDING
        ) AS YearToDateSales,
        ROUND(AVG(SUM(TotalAmount)) OVER (
            ORDER BY YEAR(OrderDate), MONTH(OrderDate)
            ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
        ), 2) AS ThreeMonthMovingAvg
    FROM Orders
    GROUP BY YEAR(OrderDate), MONTH(OrderDate)
)
SELECT
    OrderYear,
    OrderMonth,
    MonthlySales,
    PrevMonthSales,
    MonthlySales - PrevMonthSales AS MonthOverMonthChange,
    CASE
        WHEN PrevMonthSales IS NULL OR PrevMonthSales = 0 THEN NULL
        ELSE ROUND(((MonthlySales - PrevMonthSales) / PrevMonthSales) * 100, 2)
    END AS PercentChange,
    YearToDateSales,
    ThreeMonthMovingAvg,
    CASE
        WHEN MonthlySales > ThreeMonthMovingAvg THEN 'Above Trend'
        WHEN MonthlySales < ThreeMonthMovingAvg THEN 'Below Trend'
        ELSE 'On Trend'
    END AS TrendStatus,
    NextMonthSales
FROM MonthlySalesAnalysis
ORDER BY OrderYear, OrderMonth;</code></pre>
</li>
<li><strong>Execute with <code>F5</code></strong> and analyze the comprehensive view of sales performance</li>
</ol>

<p><strong>üí° Tips:</strong></p>
<ul>
<li><strong>CTE organization:</strong> Use CTEs to separate window function calculations from final formatting - improves readability and debugging</li>
<li><strong>Reusing window specs:</strong> In SQL Server 2012+, use WINDOW clause to define window specifications once and reuse them (less verbose)</li>
<li><strong>Performance optimization:</strong> Multiple window functions in one query are more efficient than multiple separate queries</li>
<li><strong>NULL handling:</strong> First and last rows will have NULLs for LAG and LEAD respectively - handle these with CASE or COALESCE</li>
<li><strong>Business value:</strong> This single query provides a complete time-series analysis dashboard that would require multiple complex self-joins in older SQL</li>
<li><strong>Keyboard shortcut:</strong> Use <code>Alt+F1</code> to get quick table information while building your query</li>
</ul>

<p><strong>‚úÖ Expected Result:</strong> A comprehensive monthly dashboard showing: MonthlySales, PrevMonthSales, NextMonthSales, MonthOverMonthChange, PercentChange, YearToDateSales, ThreeMonthMovingAvg, and TrendStatus for complete sales performance visibility</p>

<p><strong>üîÑ Connection to Day 12:</strong> This exercise synthesizes everything from Day 12 (basic window functions) and Day 14 (LAG, LEAD, running totals, moving averages) into a single powerful query. This demonstrates how window functions eliminate the need for complex self-joins and correlated subqueries, making sophisticated analytics accessible and maintainable!</p>
</div>
<h3 id="independent-practice-hour-3---60-min-14">Independent Practice (60 min):</h3>
<div class="practice-note">
<p><strong>üí° Hints for Independent Practice:</strong></p>
<ul>
<li><strong>Start simple:</strong> Begin with basic variations before attempting complex modifications</li>
<li><strong>Break it down:</strong> Divide complex problems into smaller, manageable steps</li>
<li><strong>Test incrementally:</strong> Verify each step works before moving to the next</li>
<li><strong>Use documentation:</strong> Refer to official docs or tutorials when needed</li>
<li><strong>Experiment:</strong> Try different approaches to find what works best</li>
</ul>
</div>
<p>Apply the concepts learned to different datasets and scenarios.</p>
<h3 id="daily-assignment-hour-4---60-min-14">Daily Assignment (60 min):</h3>
<p><strong>Assignment:</strong></p>
<ul>
<li><strong>Period Comparisons:</strong>Calculate sales for current month, previous month (LAG), and month-over-month % change</li>
<li><strong>Running Totals:</strong>Create year-to-date sales, quarter-to-date sales, running customer count</li>
<li><strong>Customer Analysis:</strong>Calculate days between orders per customer using LAG, identify customers with increasing order frequency</li>
</ul>
<h3 id="expected-outcomes-14">Expected Outcomes:</h3>
<ul>
<li>Use LAG and LEAD for accessing previous/next rows</li>
<li>Calculate running totals with window functions</li>
<li>Compute moving averages</li>
<li>Perform period-over-period comparisons</li>
<li>Master cumulative aggregations</li>
</ul>
<hr/>
<h2 id="quick-quiz-day-14">üìù Day 14 Quick Quiz - Test Your Knowledge!</h2>
<div class="quiz-container" data-day="14">
<div class="quiz-question" data-correct="1" data-question="1">
<p class="question-text"><strong>Q1.</strong> What does LAG() function do?</p>
<div class="quiz-options">
<label class="quiz-option">
<input name="day14_q1" type="radio" value="0"/>
<span class="option-text">Speeds up query</span>
</label>
<label class="quiz-option">
<input name="day14_q1" type="radio" value="1"/>
<span class="option-text">Accesses data from a previous row in the result set</span>
</label>
<label class="quiz-option">
<input name="day14_q1" type="radio" value="2"/>
<span class="option-text">Delays execution</span>
</label>
<label class="quiz-option">
<input name="day14_q1" type="radio" value="3"/>
<span class="option-text">Sorts data</span>
</label>
</div>
<div class="quiz-feedback" style="display:none;">
<p class="feedback-text"></p>
<p class="explanation">LAG() lets you access values from the previous row without a self-join.</p>
</div>
</div>
<div class="quiz-question" data-correct="1" data-question="2">
<p class="question-text"><strong>Q2.</strong> What does LEAD() function return?</p>
<div class="quiz-options">
<label class="quiz-option">
<input name="day14_q2" type="radio" value="0"/>
<span class="option-text">First row</span>
</label>
<label class="quiz-option">
<input name="day14_q2" type="radio" value="1"/>
<span class="option-text">Value from the next row in the result set</span>
</label>
<label class="quiz-option">
<input name="day14_q2" type="radio" value="2"/>
<span class="option-text">Last row</span>
</label>
<label class="quiz-option">
<input name="day14_q2" type="radio" value="3"/>
<span class="option-text">NULL</span>
</label>
</div>
<div class="quiz-feedback" style="display:none;">
<p class="feedback-text"></p>
<p class="explanation">LEAD() retrieves values from the following row in the ordered result set.</p>
</div>
</div>
<div class="quiz-question" data-correct="1" data-question="3">
<p class="question-text"><strong>Q3.</strong> How do you calculate a running total in SQL?</p>
<div class="quiz-options">
<label class="quiz-option">
<input name="day14_q3" type="radio" value="0"/>
<span class="option-text">Use SUM() with WHERE</span>
</label>
<label class="quiz-option">
<input name="day14_q3" type="radio" value="1"/>
<span class="option-text">Use SUM() OVER (ORDER BY date ROWS UNBOUNDED PRECEDING)</span>
</label>
<label class="quiz-option">
<input name="day14_q3" type="radio" value="2"/>
<span class="option-text">Use TOTAL()</span>
</label>
<label class="quiz-option">
<input name="day14_q3" type="radio" value="3"/>
<span class="option-text">Use COUNT()</span>
</label>
</div>
<div class="quiz-feedback" style="display:none;">
<p class="feedback-text"></p>
<p class="explanation">Window function with ROWS UNBOUNDED PRECEDING calculates cumulative sum.</p>
</div>
</div>
<div class="quiz-question" data-correct="1" data-question="4">
<p class="question-text"><strong>Q4.</strong> What does ROWS BETWEEN 1 PRECEDING AND CURRENT ROW mean?</p>
<div class="quiz-options">
<label class="quiz-option">
<input name="day14_q4" type="radio" value="0"/>
<span class="option-text">All rows</span>
</label>
<label class="quiz-option">
<input name="day14_q4" type="radio" value="1"/>
<span class="option-text">Current row and the one before it</span>
</label>
<label class="quiz-option">
<input name="day14_q4" type="radio" value="2"/>
<span class="option-text">Just current row</span>
</label>
<label class="quiz-option">
<input name="day14_q4" type="radio" value="3"/>
<span class="option-text">All previous rows</span>
</label>
</div>
<div class="quiz-feedback" style="display:none;">
<p class="feedback-text"></p>
<p class="explanation">This window frame includes the current row and one row before it (2 rows total).</p>
</div>
</div>
<div class="quiz-question" data-correct="1" data-question="5">
<p class="question-text"><strong>Q5.</strong> Can you use multiple window functions in one query?</p>
<div class="quiz-options">
<label class="quiz-option">
<input name="day14_q5" type="radio" value="0"/>
<span class="option-text">No, only one allowed</span>
</label>
<label class="quiz-option">
<input name="day14_q5" type="radio" value="1"/>
<span class="option-text">Yes, you can use multiple different window functions</span>
</label>
<label class="quiz-option">
<input name="day14_q5" type="radio" value="2"/>
<span class="option-text">Only with PARTITION BY</span>
</label>
<label class="quiz-option">
<input name="day14_q5" type="radio" value="3"/>
<span class="option-text">Only in subqueries</span>
</label>
</div>
<div class="quiz-feedback" style="display:none;">
<p class="feedback-text"></p>
<p class="explanation">You can use multiple window functions in SELECT, each with different specifications.</p>
</div>
</div>
</div>
  </div>
</div>
<div class="feedback-bar">
  <p>Have feedback or questions? <a href="mailto:gcpath@live.com?subject=30-Day Excel & SQL Training Feedback" class="feedback-link">Email us at gcpath@live.com</a></p>
</div>
<button class="back-to-top" id="back-to-top" aria-label="Back to top"></button>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 1. Add copy buttons to all code blocks
  document.querySelectorAll('pre').forEach(pre => {
    const button = document.createElement('button');
    button.className = 'copy-btn';
    button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
    </svg>`;
    button.setAttribute('aria-label', 'Copy code');
    button.setAttribute('title', 'Copy to clipboard');

    button.addEventListener('click', async () => {
      const code = pre.querySelector('code') || pre;
      const text = code.textContent;

      try {
        await navigator.clipboard.writeText(text);
        button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>`;
        button.classList.add('copied');
        setTimeout(() => {
          button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>`;
          button.classList.remove('copied');
        }, 2000);
      } catch (err) {
        button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>`;
        setTimeout(() => {
          button.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>`;
        }, 2000);
      }
    });

    pre.appendChild(button);
  });

  // 1b. Add AI assistant buttons dynamically to AI prompt code blocks
  const aiPromptHeadings = document.querySelectorAll('h3[id*="ai-learning-prompts"]');

  aiPromptHeadings.forEach(heading => {
    // Find ALL code blocks after this heading (until next h2 or h3)
    let currentElement = heading.nextElementSibling;
    const codeBlocks = [];

    while (currentElement) {
      // Stop if we hit another heading
      if (currentElement.tagName === 'H2' || currentElement.tagName === 'H3') {
        break;
      }

      // Collect all PRE elements
      if (currentElement.tagName === 'PRE') {
        codeBlocks.push(currentElement);
      }

      currentElement = currentElement.nextElementSibling;
    }

    // Add buttons to each code block found
    codeBlocks.forEach(codeBlock => {
      // Get the prompt text from THIS specific code block
      const code = codeBlock.querySelector('code') || codeBlock;
      const promptText = code.textContent.trim();

      // Create AI buttons container for THIS prompt
      const aiButtonsContainer = document.createElement('div');
      aiButtonsContainer.className = 'ai-assistant-buttons';

      // ChatGPT button - Black and white icon
      const chatgptBtn = document.createElement('a');
      chatgptBtn.href = 'https://chat.openai.com/?q=' + encodeURIComponent(promptText);
      chatgptBtn.target = '_blank';
      chatgptBtn.className = 'ai-quick-btn chatgpt-btn';
      chatgptBtn.title = 'Open in ChatGPT';
      chatgptBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.872zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08L8.704 5.46a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"/></svg>';

      // Claude button - Official Anthropic icon
      const claudeBtn = document.createElement('a');
      claudeBtn.href = 'https://claude.ai/new?q=' + encodeURIComponent(promptText);
      claudeBtn.target = '_blank';
      claudeBtn.className = 'ai-quick-btn claude-btn';
      claudeBtn.title = 'Open in Claude';
      claudeBtn.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b0/Claude_AI_symbol.svg/1024px-Claude_AI_symbol.svg.png" width="14" height="14" style="display: block;" alt="Claude">';

      // Google button
      const googleBtn = document.createElement('a');
      googleBtn.href = 'https://www.google.com/search?q=' + encodeURIComponent(promptText);
      googleBtn.target = '_blank';
      googleBtn.className = 'ai-quick-btn google-btn';
      googleBtn.title = 'Search in Google';
      googleBtn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>';

      // Add buttons to container
      aiButtonsContainer.appendChild(chatgptBtn);
      aiButtonsContainer.appendChild(claudeBtn);
      aiButtonsContainer.appendChild(googleBtn);

      // Append to the code block
      codeBlock.appendChild(aiButtonsContainer);
    });
  });

  // 1c. Quiz interaction functionality
  document.querySelectorAll('.quiz-question').forEach(question => {
    const options = question.querySelectorAll('input[type="radio"]');
    const feedback = question.querySelector('.quiz-feedback');
    const feedbackText = feedback.querySelector('.feedback-text');
    const correctAnswer = parseInt(question.dataset.correct);

    options.forEach((option, index) => {
      option.addEventListener('change', () => {
        const selectedAnswer = parseInt(option.value);

        // Show feedback
        feedback.style.display = 'block';

        if (selectedAnswer === correctAnswer) {
          // Correct answer
          question.classList.remove('incorrect');
          question.classList.add('correct');
          feedback.classList.remove('incorrect');
          feedback.classList.add('correct');
          feedbackText.classList.remove('incorrect');
          feedbackText.classList.add('correct');
          feedbackText.textContent = '‚úÖ Correct!';
        } else {
          // Incorrect answer
          question.classList.remove('correct');
          question.classList.add('incorrect');
          feedback.classList.remove('correct');
          feedback.classList.add('incorrect');
          feedbackText.classList.remove('correct');
          feedbackText.classList.add('incorrect');
          feedbackText.textContent = '‚ùå Incorrect. Try again!';
        }

        // Disable other options after selection
        options.forEach(opt => {
          if (opt !== option) {
            opt.disabled = selectedAnswer === correctAnswer;
          }
        });
      });
    });
  });

  // 2. Theme toggle functionality (Claude-style)
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.querySelector('.theme-icon');
  const themeText = document.querySelector('.theme-text');

  // Load saved theme
  const savedTheme = localStorage.getItem('training-theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  updateThemeButton(savedTheme);

  function updateThemeButton(theme) {
    if (theme === 'dark') {
      themeIcon.textContent = '‚òÄÔ∏è';
      themeText.textContent = 'Light';
    } else {
      themeIcon.textContent = 'üåô';
      themeText.textContent = 'Dark';
    }
  }

  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('training-theme', newTheme);
      updateThemeButton(newTheme);
    });
  }

  // 2b. Font selector functionality
  const fontSelector = document.getElementById('font-selector');

  // Load saved font preference (default to Candara)
  const savedFont = localStorage.getItem('training-font') || 'candara';
  document.documentElement.setAttribute('data-font', savedFont);
  fontSelector.value = savedFont;

  fontSelector.addEventListener('change', (e) => {
    const selectedFont = e.target.value;
    document.documentElement.setAttribute('data-font', selectedFont);
    localStorage.setItem('training-font', selectedFont);
  });

  // 2c. Font size controls
  const fontSizes = ['small', 'medium', 'large', 'x-large'];
  const decreaseBtn = document.getElementById('decrease-font');
  const increaseBtn = document.getElementById('increase-font');

  // Load saved font size (default to medium)
  let currentSizeIndex = fontSizes.indexOf(localStorage.getItem('training-font-size') || 'medium');
  if (currentSizeIndex === -1) currentSizeIndex = 1; // Default to medium

  function applyFontSize(index) {
    document.documentElement.setAttribute('data-font-size', fontSizes[index]);
    localStorage.setItem('training-font-size', fontSizes[index]);

    // Disable buttons at limits
    decreaseBtn.disabled = index === 0;
    increaseBtn.disabled = index === fontSizes.length - 1;
  }

  applyFontSize(currentSizeIndex);

  decreaseBtn.addEventListener('click', () => {
    if (currentSizeIndex > 0) {
      currentSizeIndex--;
      applyFontSize(currentSizeIndex);
    }
  });

  increaseBtn.addEventListener('click', () => {
    if (currentSizeIndex < fontSizes.length - 1) {
      currentSizeIndex++;
      applyFontSize(currentSizeIndex);
    }
  });

  // 3. Highlight active page in TOC and scroll to it (improved)
  const currentPage = window.location.pathname.split('/').pop() || 'SQL-and-Excel-Course.html';
  const tocLinks = document.querySelectorAll('nav#TOC a');
  const tocLinksArray = Array.from(tocLinks);

  tocLinks.forEach((link, index) => {
    const linkHref = link.getAttribute('href');
    if (linkHref === currentPage || linkHref === `../${currentPage}`) {
      link.classList.add('active');

      // Smart TOC scrolling - center items unless near the end
      setTimeout(() => {
        const totalLinks = tocLinksArray.length;
        const isNearEnd = index > totalLinks * 0.8; // Last 20% of links

        // Use scrollIntoView for smooth, smart scrolling
        link.scrollIntoView({
          behavior: 'smooth',
          block: isNearEnd ? 'nearest' : 'center',
          inline: 'nearest'
        });
      }, 100);
    }
  });

  // 4. Back to top button functionality
  const backToTopBtn = document.getElementById('back-to-top');
  if (backToTopBtn) {
    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
  }
});
</script>

</body>
</html>